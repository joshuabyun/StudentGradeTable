<!doctype html>
<html>
<head>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.7/angular.min.js"></script>
    <meta name="viewport" content="initial-scale=1, user-scalable=no">
</head>
<body ng-app="myApp" ng-controller="namingController as fc">
<div class="container" ng-controller="inputController as ic">
    <div class="page-header">
        <h1 class="visible-md visible-lg">{{fc.title}}
            <small class="pull-right">{{fc.grade}}<span class="avgGrade label label-default">0</span></small>
        </h1>
        <h3 class=" visible-xs visible-sm">{{fc.title}}
            <small class="pull-right">{{fc.grade}}<span class="avgGrade label label-default">10</span></small>
        </h3>
    </div>
    <div class="student-add-form form-group col-sm-4 col-sm-push-8">
        <form role="form" class="form-group">
            <h4>{{fc.addStudent}}</h4>
            <div class="input-group form-group">
                <span class="input-group-addon">
                    <span class="glyphicon glyphicon-user"></span>
                </span>
                <input type="text" class="form-control" placeholder="Student Name" ng-model="ic.student.name">
            </div>
            <div class="input-group form-group">
                <span class="input-group-addon">
                    <span class="glyphicon glyphicon-list-alt"></span>
                </span>
                <input type="text" class="form-control" placeholder="Student Course" ng-model="ic.student.course">
            </div>
            <div class="input-group form-group">
                <span class="input-group-addon">
                    <span class="glyphicon glyphicon-education"></span>
                </span>
                <input type="text" class="form-control" placeholder="Student Grade" ng-model="ic.student.grade">
            </div>
            <div class="form-group">
                <button type="button" class="btn btn-success" ng-click="ic.addClicked()">{{fc.add}}</button>
                <button type="button" class="btn btn-default" ng-click="ic.cancelClicked()">{{fc.cancel}}</button>
            </div>
            <div class="form-group">
                <button type="button" class="btn btn-warning" ng-click="ic.getDataFromServer()">{{fc.getData}}</button>
            </div>
        </form>
    </div>
    <div class="student-list-container  col-sm-8 col-sm-pull-4">
        <table class="student-list table table-striped">
            <thead>
                <tr>
                    <th>{{fc.studentName}}</th>
                    <th>{{fc.studentCourse}}</th>
                    <th>{{fc.studentGrade}}</th>
                    <th>{{fc.operation}}</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>{{ic.student.name}}</td>
                    <td>{{ic.student.course}}</td>
                    <td>{{ic.student.grade}}</td>
                </tr>
                <tr ng-repeat = "obj in studentArray">
                    <td>{{obj.name}}</td>
                    <td>{{obj.course}}</td>
                    <td>{{obj.grade}}</td>
                    <td><button class="btn btn-danger" ng-click="ic.delArrElement($index)">Delete</button></td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        var app = angular.module("myApp", []);
        app.controller("namingController", function(){
            this.title = "Student Grade Table";
            this.grade = "Grade Average : ";
            this.addStudent = "Add Student";
            this.add = "Add";
            this.cancel = "Cancel";
            this.getData = "Get Data From Server";
            this.studentName = "Student Name";
            this.studentCourse = "Student Course";
            this.studentGrade = "Student Grade";
            this.operation = "Operation";
        });
        app.controller("inputController",function($scope){
            $scope.studentArray = [];
            this.student = {id:null};
            this.addClicked = function(){
                this.addStudent();
                this.clearAddStudentForm();
                console.log("updated studentArray : ",$scope.studentArray);
            };
            this.addStudent = function(){
                $scope.studentArray.push(this.student);
                //this.calculateAverage();
            };
            this.cancelClicked = function(){
                this.clearAddStudentForm();
            };
            this.clearAddStudentForm = function(){
                this.student ={};
            };
            this.delArrElement = function(index){
                $scope.studentArray.splice(index,1);
                console.log("updated studentArray after delete : ",$scope.studentArray);
            }
            this.getDataFromServer = function(){ //when dom loads or when 'get data from server' button pressed
                $.ajax({
                    url: "http://s-apis.learningfuze.com/sgt/get",
                    dataType: "json",
                    data: {api_key:"Syh9yhgpdU"},
                    method: "post",
                    success: function(response){
                        var studentDatabase = response.data;
                        if (response.success){
                            console.log("new info fetched from the server : ",response);
                            //resetApplication(); //if data received successfully, reset student array;
                            $('tbody >tr').remove(); //remove current dom
                            for (var i = 0; i < studentDatabase.length; i++ ){
                                //studentAdd();     ///need to use $http for ajax call in angular
                            }
                        }
                    }
                });
            }
        });
    </script>
</div>
</body>
</html>
